generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
  moduleFormat = "cjs"
}

datasource db {
  provider = "postgresql"
}

model User {
  idUser String @id @unique @default(uuid()) @map("id_user")
  lastName String @db.VarChar(100) @map("last_name")
  firstName String @db.VarChar(100) @map("first_name")
  username String @db.VarChar(100) @unique @map("username")
  mail String @db.VarChar(255) @unique @map("mail")
  hashedPassword String @db.VarChar(250) @map("hashed_password")
  isDeleted Boolean @default(false) @map("is_deleted")

  projects Projects[]

  @@map("user")
}

model Category { 
  idCategory Int @id @unique @map("id_category")
  name String @db.VarChar(100)

  projects Projects[]

  @@map("category")
}

model TaskCategories { 
  idTaskCategory Int @id @unique @default(autoincrement()) @map("id_task_category")
  name String @db.VarChar(100) @map("name")

  task Tasks[]

  @@map("task_categories")
}

model Projects {
  idProject String @id @unique @default(uuid()) @map("id_project")
  name String @db.VarChar(100) @map("name")
  status String @db.VarChar(100) @map("status")
  type String @db.VarChar(100) @map("type")
  passedTime Int @map("passed_time")
  description String @db.VarChar(1000)
  isDeleted Boolean @default(false) @map("is_deleted")
  createdAt DateTime @default(now()) @map("created_at")
  updateAt DateTime @updatedAt @map("update_at")

  userId String @map("user_id")
  categoryId Int @map("category_id")

  user User @relation(fields: [userId], references: [idUser])
  category Category @relation(fields: [categoryId], references: [idCategory])

  links Links[]
  notes Notes[]

  @@index([userId])
  @@index([categoryId])
  @@index([isDeleted])
  @@index([status])

  @@map("projects")
}

model Links {
  idLink Int @id @unique @default(autoincrement()) @map("id_links")
  name String @db.VarChar(100) @map("name")
  url String @db.VarChar(500) @map("url")
  isDeleted Boolean @default(false) @map("is_deleted")
  createdAt DateTime @default(now()) @map("created_at")
  updateAt DateTime  @updatedAt @map("update_at")

  projectId String @map("project_id")
  project Projects @relation(fields: [projectId], references: [idProject])

  task Tasks[]

  @@index([projectId])
  @@index([isDeleted])

  @@map("links")
}

model Tasks{
  idTask Int @id @unique @default(autoincrement()) @map("id_task")
  name String @db.VarChar(100) @map("name")
  description String @db.VarChar(1000) @map("description")
  estimedTime Int @map("estimed_time")
  isRealised Boolean @default(false) @map("is_realised")
  isDeleted Boolean @default(false) @map("is_deleted")
  creatdAt DateTime @default(now()) @map("created_at")
  updateAt DateTime @updatedAt @map("update_at") 

  linkId Int @map("link_id")
  taskCategoryId Int @map("category_id")

  link Links @relation(fields: [linkId], references: [idLink])
  category TaskCategories @relation(fields: [taskCategoryId], references: [idTaskCategory])

  notes Notes[]

  @@index([linkId])
  @@index([taskCategoryId])
  @@index([isDeleted])
  @@index([isRealised])

  @@map("tasks")
}

model Notes{
  idNotes Int @id @unique @default(autoincrement()) @map("id_note")
  name String @db.VarChar(100) @map("name")
  description String @db.VarChar(500) @map("description")
  content String @db.VarChar(1000) @map("content")
  isDeleted Boolean @default(false) @map("is_deleted")  
  createdAt DateTime @default(now()) @map("created_at")
  updateAt DateTime @map("update_at")

  taskId Int? @map("task_id")
  projectId String @map("project_id")

  task Tasks? @relation(fields: [taskId], references: [idTask])
  project Projects @relation(fields: [projectId], references: [idProject])

  @@index([taskId])
  @@index([projectId])
  @@index([isDeleted])

  @@map("notes")
}
 
